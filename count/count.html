<!DOCTYPE html>
<html>

<head>
    <title>error count</title>
    <meta charset="UTF-8">
    <script>
        window.onload = function () {
            // Pobierz dane z pliku na serwerze
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    var lastFailureDate = new Date(data.lastFailureDate);
                    var maxDaysWithoutFailure = data.maxDaysWithoutFailure;
                    var numberOfFailuresThisYear = data.numberOfFailuresThisYear;
                    document.getElementById("daysWithoutFailure").innerHTML = (new Date() - lastFailureDate) / (1000 * 60 * 60 * 24);
                    document.getElementById("maxDaysWithoutFailure").innerHTML = maxDaysWithoutFailure;
                    document.getElementById("numberOfFailuresThisYear").innerHTML = numberOfFailuresThisYear;
                }
            };
            xhr.open("GET", "data.php", true);
            xhr.send();
            // Zarejestruj funkcję obsługującą kliknięcie przycisku
            document.getElementById("failureButton").addEventListener("click", function () {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var data = JSON.parse(xhr.responseText);
                        var lastFailureDate = new Date(data.lastFailureDate);
                        var maxDaysWithoutFailure = data.maxDaysWithoutFailure;
                        var numberOfFailuresThisYear = data.numberOfFailuresThisYear;
                        document.getElementById("daysWithoutFailure").innerHTML = 0;
                        document.getElementById("maxDaysWithoutFailure").innerHTML = maxDaysWithoutFailure;
                        document.getElementById("numberOfFailuresThisYear").innerHTML = numberOfFailuresThisYear;
                    }
                };
                xhr.open("POST", "data.php", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.send("action=failure");
            });
        };
    </script>
</head>

<body>
    <p>Ilość dni bez awarii: <span id="daysWithoutFailure">0</span></p>
    <p>Rekord dni bez awarii: <span id="maxDaysWithoutFailure">0</span></p>
    <p>Ilość awarii w tym roku: <span id="numberOfFailuresThisYear">0</span></p>
    <button id="failureButton">Zgłoś awarię</button>
</body>

</html>
